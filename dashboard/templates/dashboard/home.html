{% extends 'dashboard/base.html' %}
{% load static account %}

{% block title %}Home{% endblock %}

{% block header %}
<script type="text/javascript">
    var labelNum = [];
    var arr = []; 
    var index =0;
    //with debug on, this has no args
    function Upload(arg) {
        //debug only 
       //var fileUpload = document.getElementById("fileUpload"); 
        document.getElementById("loginMessage").innerText = "";
       // var fileUpload = arg;

        var p = document.createTextNode(arg);
        var dvCSV = document.getElementById("dvCSV");
        dvCSV.innerHTML = "";
        dvCSV.appendChild(p);
        arr[index] = (arg.match(/1/g) || []).length;
        labelNum[index] = "timestamp";
        index++;
        writeGraph(arr,labelNum);

    }
  
</script>
  
<link rel = "stylesheet" href="{% static 'pages/lstyle.css' %}">
{% endblock %}

{% block content %}
<div id = "header" align = "center">
    <div class="title">
        <h1>Code Blooded Intrusion Detection </h1>
        <div class="profile-container">
            <div class="username">
                Hi {% user_display user %}!
                <p><a href="{% url 'account_logout' %}">logout</a></p>
            </div>
            <div>
                {% if user.profile %}
                    {% if user.profile.has_profile_image %}
                        <img class="profile-pic" src="{{ user.profile.profile_image.url }}" />
                    {% elif user.profile.has_avatar_url %}
                        <img class="profile-pic" src="{{ user.profile.avatar_url }}" />
                    {% endif %}
                {% else %}
                    <img class="profile-pic" src="{% static 'pages/generic_user.png' %}" />
                {% endif %}
            </div>
        </div>
    </div>
    {% include 'pages/topbar.html' %}
<div id = "deviceList" align="center">
    <div id="loginMessage"></div>
    <!-- Debug only, manually upload files through webpage with this
    <input type="file" id="fileUpload" />
    <input type="button" id="upload" value="Upload" onclick="Upload()" />
    <hr />-->
    <div id="dvCSV">
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js">
    </script>
    <canvas id="myChart" width="20" height="20"></canvas>
    <!--<img src="{% static 'pages/construction.png' %}"/> -->
</div>
</div>

<script>

    function writeGraph(arr,labelNum){
    var ctx = document.getElementById("myChart").getContext('2d');
    var myChart = new Chart(ctx, {
      type: 'bar',
      data: {
    labels: labelNum,
    datasets: [{
      label: 'Devices',
      data: arr,
      backgroundColor: 'rgb(7, 17, 130)',
  
    }]
  
      },
      options: {
        title: {
          display: true,
          text: 'Intrusion Detection Graphical Implementation',
          fontSize: 16,
          fontColor: '#000080',
        },
      scales: {
     
      xAxes: [{
        scaleLabel: {
         display: true,
         labelString: 'Timestamps of Trials',
         fontSize: 16,
         fontColor: '#000080',
       }
     }, {
        display: false,
        ticks: {
          fontSize: 16,
          fontColor: '#000080',
          autoSkip: false,
            max: 4,
        }
      }],
      yAxes: [{
        scaleLabel: {
         display: true,
         labelString: 'Number of Intrusions',
         fontSize: 16,
         fontColor: '#000080',
       },
        ticks: {
        fontSize: 16,
        fontColor: '#000080',
        beginAtZero:true
        }
      }]
    }
      }
    });
    }

    Upload("[1,0,0,0,1,1,0,0,1,1]")
  
  </script>
  

 {% endblock %}

